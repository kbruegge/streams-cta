<application>

    <!--<stream id="cta:data" class="streams.cta.io.SyntheticEventStream"-->
    <!--limit="10000" />-->

    <!--<stream id="cta:data" class="streams.cta.io.eventio.EventIOStream" url="file:/Users/kai/Downloads/electron_20deg_90deg_run7683___cta-trg-test-LST4_desert_samplemode_test-250MHz.simtel"-->
    <!--limit="1000" />-->
    <!--<property name="infile" value="/fhgfs/groups/app/fact/cta/" />-->
    <property name="infile" value="/Users/kai/fact_phido/cta/" />

    <property name="num_copies" value="1" />

    <stream id="cta:data_${copy.id}" class="streams.cta.io.RecursiveDirectoryStream"
            suffix=".kryo" url="file:${infile}" copies="${num_copies}" multiply="200">
        <stream id="cta:data" class="streams.cta.io.KryoStream"/>
    </stream>

    <stream.io.BlockingQueue id="performance" />

    <process input="cta:data_${copy.id}" copies="${num_copies}">
        <streams.DataRate every="1000" logmemory="true"/>
        <streams.cta.datacorrection.BaselineShift />
        <streams.cta.extraction.MaxAmplitude />
        <streams.cta.extraction.ArrivalTimeRisingEdge/>
        <streams.cta.extraction.PhotonsSignalAmplitude />
        <streams.cta.cleaning.TwoLevelTimeNeighbor />
        <streams.cta.features.Size/>
        <streams.cta.features.COG/>
        <streams.cta.features.WidthLengthDelta/>
        <Enqueue queues="performance" condition="%{data.@datarate} != null"/>
    </process>

    <process input="performance">
        <!--<PrintData/>-->
        <streams.cta.io.JSONWriter url="file:./eventrate_vs_time_${num_copies}_threads.json" keys="@datarate,@freememory,@maxmemory,@totalmemory" writeblock="true"/>
    </process>

</application>