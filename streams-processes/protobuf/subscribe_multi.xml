<application>
    
    <!--<stream id="cta:data" class="streams.cta.io.SyntheticEventStream"-->
        <!--limit="10000" />-->

    <!--<property name="infile" value="/Users/kai/fact_phido/cta/gamma_20deg_0deg_run40814___cta-prod2_desert-1640m-Aar.simtel.gz" />-->
    <!--<property name="outfile" value="./data.kryo" />-->


    <property name="num_copies" value="1" />

    <stream id="cta:data_0" class="streams.cta.io.protobuf.ProtoRawEventStream"
             addresses="tcp://127.0.0.1:5550,tcp://127.0.0.1:5551"/>
    <stream id="cta:data_1" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5551,tcp://127.0.0.1:5552"/>
    <stream id="cta:data_2" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5552,tcp://127.0.0.1:5553"/>
    <stream id="cta:data_3" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5553,tcp://127.0.0.1:5554"/>
    <stream id="cta:data_4" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5554,tcp://127.0.0.1:5555"/>
    <stream id="cta:data_5" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5555,tcp://127.0.0.1:5556"/>
    <stream id="cta:data_6" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5556,tcp://127.0.0.1:5557"/>
    <stream id="cta:data_7" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5557,tcp://127.0.0.1:5558"/>
    <stream id="cta:data_8" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5558,tcp://127.0.0.1:5559"/>
    <stream id="cta:data_9" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:5559,tcp://127.0.0.1:55510"/>
    <stream id="cta:data_10" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:55510,tcp://127.0.0.1:55511"/>
    <stream id="cta:data_11" class="streams.cta.io.protobuf.ProtoRawEventStream"
            addresses="tcp://127.0.0.1:55511,tcp://127.0.0.1:5550"/>


    <queue class="stream.io.BlockingQueue" id="performance" />

    <process input="cta:data_${copy.id}" copies="${num_copies}">
        <streams.DataRate every="5000" logmemory="true"/>
        <Enqueue queues="performance" condition="%{data.@datarate} != null"/>
        <streams.cta.datacorrection.BaselineShift />
        <streams.cta.extraction.Photons />
        <streams.cta.extraction.ArrivalTime />
        <streams.cta.cleaning.TwoLevelTimeNeighbor levels="400,320,120,100" />
        <streams.cta.features.Size/>
        <streams.cta.features.COG/>
        <streams.cta.features.WidthLengthDelta/>
    </process>

    <process input="performance">
        <!--<PrintData/>-->
        <streams.cta.io.JSONWriter url="file:./subscription_multi.json" keys="@stream,@datarate" writeblock="true"/>
    </process>
    
</application>