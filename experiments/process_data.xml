<application>

<property name="prefix" value="proton*.json.gz" />
<property name="folder" value="./data/raw" />
<property name="limit" value="-1" />
<property name="outfile" value="./data/processed/protons_training_features.csv" />

<stream id="cta:data"
        class="streams.cta.io.RecursiveDirectoryStream"
        url="file:${folder}"
        pattern="${prefix}" >

    <stream id="images" class="streams.cta.io.ImageStream" limit="${limit}"/>

</stream>


<process input="cta:data">
    <streams.cta.SplitByTelescope key="@telescopes" />
    <ForEach key="@telescopes">
        <streams.cta.cleaning.TailCut />
        <streams.cta.features.Moments />
        <streams.cta.io.CSVWriter keys="event_id,telescope:*,type:name,shower:*,*num_trigge*,mc:*" url="file:${outfile}"/>
    </ForEach>
    <streams.cta.MergeByTelescope key="@telescopes"/>
    <streams.DataRate every="4000"/>
</process>

</application>
